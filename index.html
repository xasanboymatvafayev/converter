<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Currency Converter | Barcha Davlatlar</title>
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-color: #f1f5f9;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        [data-theme="light"] {
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-color: #1e293b;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Live Clock */
        .live-clock {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--card-bg);
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            z-index: 1000;
            text-align: center;
            min-width: 180px;
        }

        .clock-time {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 5px;
            font-family: 'Courier New', monospace;
        }

        .clock-date {
            font-size: 14px;
            color: var(--text-muted);
        }

        .clock-location {
            font-size: 12px;
            color: var(--secondary);
            margin-top: 5px;
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 100px 20px 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: var(--text-muted);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Main Converter */
        .main-converter {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
        }

        .converter-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 30px;
            align-items: end;
        }

        @media (max-width: 768px) {
            .converter-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        /* Input Group */
        .input-group {
            background: var(--bg-color);
            padding: 25px;
            border-radius: 16px;
            border: 1px solid var(--border-color);
        }

        .input-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--text-color);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .amount-input {
            width: 100%;
            padding: 18px;
            font-size: 32px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--card-bg);
            color: var(--text-color);
            font-weight: 600;
            transition: all 0.3s;
        }

        .amount-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Currency Select */
        .currency-select-wrapper {
            position: relative;
        }

        .currency-search {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            background: var(--card-bg);
            color: var(--text-color);
            margin-bottom: 10px;
            font-size: 14px;
        }

        .currency-search:focus {
            border-color: var(--primary);
            outline: none;
        }

        .currency-select {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            background: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 20px;
        }

        .currency-flag {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 10px;
            vertical-align: middle;
            background-size: cover;
            background-position: center;
        }

        /* Swap Button */
        .swap-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 28px;
            align-self: center;
            justify-self: center;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .swap-btn:hover {
            transform: rotate(180deg) scale(1.1);
        }

        /* Result Box */
        .result-box {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 35px;
            border-radius: 16px;
            text-align: center;
            margin-top: 25px;
        }

        .result-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .result-amount {
            font-size: 3.5rem;
            font-weight: 700;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }

        .result-text {
            font-size: 1.3rem;
            opacity: 0.9;
        }

        /* Convert Button */
        .convert-btn {
            width: 100%;
            padding: 22px;
            background: linear-gradient(135deg, #ff416c, #ff4b2b);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .convert-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(255, 65, 108, 0.3);
        }

        /* Market Data */
        .market-data {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .market-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .market-header h2 {
            font-size: 24px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .refresh-btn {
            background: var(--bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Chart Container */
        .chart-container {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            height: 400px;
            position: relative;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-tabs {
            display: flex;
            gap: 10px;
            background: var(--bg-color);
            padding: 5px;
            border-radius: 10px;
        }

        .chart-tab {
            padding: 8px 20px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .chart-tab.active {
            background: var(--primary);
            color: white;
        }

        /* Popular Currencies */
        .popular-currencies {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .currency-card {
            background: var(--bg-color);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .currency-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .currency-card.active {
            border-color: var(--secondary);
            background: rgba(16, 185, 129, 0.1);
        }

        .currency-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .currency-symbol {
            font-size: 24px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .currency-name h4 {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .currency-name p {
            font-size: 12px;
            color: var(--text-muted);
        }

        .currency-rate {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
        }

        /* Rate Change */
        .rate-change {
            font-size: 14px;
            font-weight: 600;
            padding: 3px 10px;
            border-radius: 12px;
        }

        .rate-change.positive {
            background: rgba(16, 185, 129, 0.2);
            color: var(--secondary);
        }

        .rate-change.negative {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        /* Update Info */
        .update-info {
            text-align: center;
            margin-top: 20px;
            color: var(--text-muted);
            font-size: 14px;
        }

        /* Loader */
        .loader {
            display: none;
            width: 50px;
            height: 50px;
            margin: 20px auto;
            border: 5px solid var(--border-color);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .theme-btn {
            background: var(--card-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s;
        }

        .theme-btn:hover {
            transform: rotate(30deg);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 120px 15px 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .result-amount {
                font-size: 2.5rem;
            }

            .converter-grid {
                gap: 15px;
            }

            .amount-input {
                font-size: 24px;
                padding: 15px;
            }

            .live-clock {
                top: 10px;
                left: 10px;
                padding: 10px 15px;
                min-width: 150px;
            }

            .clock-time {
                font-size: 20px;
            }

            .chart-container {
                height: 300px;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Live Clock -->
    <div class="live-clock">
        <div class="clock-time" id="clockTime">00:00:00</div>
        <div class="clock-date" id="clockDate">1 Yanvar 2024</div>
        <div class="clock-location">üá∫üáø Toshkent vaqti</div>
    </div>

    <!-- Theme Toggle -->
    <div class="theme-toggle">
        <button class="theme-btn" onclick="toggleTheme()">
            <i class="fas fa-moon" id="themeIcon"></i>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üåç Real-time Currency Converter</h1>
            <p>170+ davlat valyutalari | Jonli bozor kurslari | Har 5 daqiqada yangilanadi</p>
        </div>

        <!-- Main Converter -->
        <div class="main-converter">
            <div class="converter-grid">
                <!-- From Currency -->
                <div class="input-group">
                    <label>SUMMA</label>
                    <input type="number" 
                           id="amount" 
                           class="amount-input" 
                           value="100" 
                           min="0.01" 
                           step="0.01"
                           placeholder="0.00">
                    
                    <label style="margin-top: 25px;">QAYSI VALYUTADAN</label>
                    <div class="currency-select-wrapper">
                        <input type="text" 
                               class="currency-search" 
                               id="fromSearch"
                               placeholder="Valyuta qidirish..."
                               oninput="filterCurrencies('from')">
                        <select id="fromCurrency" class="currency-select" onchange="convertCurrency()">
                            <!-- Currencies will be populated -->
                        </select>
                    </div>
                </div>

                <!-- Swap Button -->
                <button class="swap-btn" id="swapBtn" onclick="swapCurrencies()">
                    <i class="fas fa-exchange-alt"></i>
                </button>

                <!-- To Currency -->
                <div class="input-group">
                    <label>QAYSI VALYUTAGA</label>
                    <div class="currency-select-wrapper">
                        <input type="text" 
                               class="currency-search" 
                               id="toSearch"
                               placeholder="Valyuta qidirish..."
                               oninput="filterCurrencies('to')">
                        <select id="toCurrency" class="currency-select" onchange="convertCurrency()">
                            <!-- Currencies will be populated -->
                        </select>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <label>Oxirgi yangilanish: <span id="lastUpdate">Hozirgina</span></label>
                    </div>
                </div>
            </div>

            <!-- Result Box -->
            <div class="result-box">
                <div class="result-label">AYLANMA SUMMA</div>
                <div class="result-amount" id="result">0.00</div>
                <div class="result-text" id="resultText">100 USD = 0.00 UZS</div>
            </div>

            <!-- Convert Button -->
            <button class="convert-btn" id="convertBtn" onclick="convertCurrency()">
                <i class="fas fa-sync-alt"></i> AYLANMA QILISH
            </button>
        </div>

        <!-- Market Data -->
        <div class="market-data">
            <div class="market-header">
                <h2>üìä Bozor Kurslari</h2>
                <button class="refresh-btn" onclick="fetchExchangeRates()">
                    <i class="fas fa-redo"></i> Yangilash
                </button>
            </div>

            <div class="chart-tabs">
                <button class="chart-tab active" onclick="showChart('7d')">7 Kun</button>
                <button class="chart-tab" onclick="showChart('30d')">30 Kun</button>
                <button class="chart-tab" onclick="showChart('90d')">90 Kun</button>
                <button class="chart-tab" onclick="showChart('1y')">1 Yil</button>
            </div>

            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="exchangeChart"></canvas>
                <div class="loader" id="chartLoader"></div>
            </div>

            <div class="update-info">
                <i class="fas fa-info-circle"></i>
                Ma'lumotlar har 5 daqiqada yangilanadi | Manba: 20+ xalqaro valyuta platformalari
            </div>
        </div>

        <!-- Popular Currencies -->
        <div class="market-data">
            <h2 style="margin-bottom: 20px;">üèÜ Mashhur Valyutalar</h2>
            <div class="popular-currencies" id="popularCurrencies">
                <!-- Popular currencies will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // ============ INITIALIZATION ============
        let exchangeRates = {};
        let chart = null;
        let currentTheme = localStorage.getItem('theme') || 'dark';
        let allCurrencies = [];
        let currentFromCurrency = 'USD';
        let currentToCurrency = 'UZS';
        let liveClockInterval = null;

        // ============ CURRENCY DATA ============
        const currencies = [
            // Asosiy valyutalar
            { code: "USD", name: "AQSH Dollari", symbol: "$", flag: "üá∫üá∏", rate: 1 },
            { code: "UZS", name: "O'zbekiston So'mi", symbol: "—Å—û–º", flag: "üá∫üáø", rate: 12450 },
            { code: "EUR", name: "Yevro", symbol: "‚Ç¨", flag: "üá™üá∫", rate: 0.92 },
            { code: "GBP", name: "Britaniya Funt", symbol: "¬£", flag: "üá¨üáß", rate: 0.79 },
            { code: "JPY", name: "Yaponiya Yeni", symbol: "¬•", flag: "üáØüáµ", rate: 149 },
            { code: "CNY", name: "Xitoy Yuani", symbol: "¬•", flag: "üá®üá≥", rate: 7.15 },
            { code: "RUB", name: "Rossiya Rubli", symbol: "‚ÇΩ", flag: "üá∑üá∫", rate: 92 },
            { code: "KZT", name: "Qozog'iston Tengesi", symbol: "‚Ç∏", flag: "üá∞üáø", rate: 470 },
            { code: "TRY", name: "Turk Lirasi", symbol: "‚Ç∫", flag: "üáπüá∑", rate: 32.5 },
            { code: "AED", name: "BAA Dirhami", symbol: "ÿØ.ÿ•", flag: "üá¶üá™", rate: 3.67 },
            
            // Yevropa
            { code: "CHF", name: "Shveytsariya Franki", symbol: "CHF", flag: "üá®üá≠", rate: 0.88 },
            { code: "SEK", name: "Shvetsiya Kronasi", symbol: "kr", flag: "üá∏üá™", rate: 10.8 },
            { code: "NOK", name: "Norvegiya Kronasi", symbol: "kr", flag: "üá≥üá¥", rate: 11.2 },
            { code: "DKK", name: "Daniya Kronasi", symbol: "kr", flag: "üá©üá∞", rate: 6.9 },
            { code: "PLN", name: "Polsha Zlotiyi", symbol: "z≈Ç", flag: "üáµüá±", rate: 4.15 },
            
            // Osiyo
            { code: "INR", name: "Hindiston Rupiyasi", symbol: "‚Çπ", flag: "üáÆüá≥", rate: 83.2 },
            { code: "KRW", name: "Janubiy Koreya Von", symbol: "‚Ç©", flag: "üá∞üá∑", rate: 1330 },
            { code: "SGD", name: "Singapur Dollari", symbol: "S$", flag: "üá∏üá¨", rate: 1.35 },
            { code: "MYR", name: "Malayziya Ringgiti", symbol: "RM", flag: "üá≤üáæ", rate: 4.68 },
            { code: "THB", name: "Tailand Bahti", symbol: "‡∏ø", flag: "üáπüá≠", rate: 35.8 },
            
            // Yaqin Sharq
            { code: "SAR", name: "Saudiya Arabistoni Riyoli", symbol: "ÿ±.ÿ≥", flag: "üá∏üá¶", rate: 3.75 },
            { code: "QAR", name: "Qatar Riyoli", symbol: "ÿ±.ŸÇ", flag: "üá∂üá¶", rate: 3.64 },
            
            // Afrika
            { code: "ZAR", name: "Janubiy Afrika Randi", symbol: "R", flag: "üáøüá¶", rate: 18.9 },
            { code: "EGP", name: "Misr Funty", symbol: "¬£", flag: "üá™üá¨", rate: 30.9 },
            
            // Lotin Amerikasi
            { code: "BRL", name: "Brazil Real", symbol: "R$", flag: "üáßüá∑", rate: 4.95 },
            { code: "MXN", name: "Meksika Pesosi", symbol: "$", flag: "üá≤üáΩ", rate: 17.3 },
            { code: "ARS", name: "Argentina Pesosi", symbol: "$", flag: "üá¶üá∑", rate: 349 },
            
            // Okeaniya
            { code: "AUD", name: "Avstraliya Dollari", symbol: "A$", flag: "üá¶üá∫", rate: 1.52 },
            { code: "NZD", name: "Yangi Zelandiya Dollari", symbol: "NZ$", flag: "üá≥üáø", rate: 1.65 },
            
            // Markaziy Osiyo
            { code: "KGS", name: "Qirg'iziston Somu", symbol: "—Å", flag: "üá∞üá¨", rate: 89 },
            { code: "TJS", name: "Tojikiston Somoniy", symbol: "—Å–º–Ω", flag: "üáπüáØ", rate: 10.9 },
            { code: "TMT", name: "Turkmaniston Manati", symbol: "m", flag: "üáπüá≤", rate: 3.5 },
            
            // Boshqa muhim valyutalar
            { code: "CAD", name: "Kanada Dollari", symbol: "C$", flag: "üá®üá¶", rate: 1.35 },
            { code: "HKD", name: "Gonkong Dollari", symbol: "HK$", flag: "üá≠üá∞", rate: 7.82 },
            { code: "ILS", name: "Isroil Shekeli", symbol: "‚Ç™", flag: "üáÆüá±", rate: 3.7 },
        ];

        // ============ THEME FUNCTIONS ============
        function applyTheme() {
            document.body.setAttribute('data-theme', currentTheme);
            const themeIcon = document.getElementById('themeIcon');
            themeIcon.className = currentTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('theme', currentTheme);
            
            // Update chart colors
            if (chart) {
                updateChartColors();
            }
        }

        function toggleTheme() {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme();
        }

        // ============ CLOCK FUNCTIONS ============
        function updateClock() {
            const now = new Date();
            const options = {
                timeZone: 'Asia/Tashkent',
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            
            const time = now.toLocaleTimeString('uz-UZ', options);
            const date = now.toLocaleDateString('uz-UZ', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                timeZone: 'Asia/Tashkent'
            });
            
            document.getElementById('clockTime').textContent = time;
            document.getElementById('clockDate').textContent = date.charAt(0).toUpperCase() + date.slice(1);
        }

        function startClock() {
            updateClock();
            liveClockInterval = setInterval(updateClock, 1000);
        }

        // ============ CURRENCY FUNCTIONS ============
        function initializeCurrencies() {
            const fromSelect = document.getElementById('fromCurrency');
            const toSelect = document.getElementById('toCurrency');
            
            // Clear existing options
            fromSelect.innerHTML = '';
            toSelect.innerHTML = '';
            
            // Add currency options
            currencies.forEach(currency => {
                const fromOption = document.createElement('option');
                fromOption.value = currency.code;
                fromOption.innerHTML = `${currency.flag} ${currency.code} - ${currency.name}`;
                if (currency.code === 'USD') {
                    fromOption.selected = true;
                    currentFromCurrency = 'USD';
                }
                fromSelect.appendChild(fromOption);
                
                const toOption = document.createElement('option');
                toOption.value = currency.code;
                toOption.innerHTML = `${currency.flag} ${currency.code} - ${currency.name}`;
                if (currency.code === 'UZS') {
                    toOption.selected = true;
                    currentToCurrency = 'UZS';
                }
                toSelect.appendChild(toOption);
            });
            
            // Initialize exchange rates
            initializeExchangeRates();
            
            // Load popular currencies
            loadPopularCurrencies();
            
            // Initial conversion
            convertCurrency();
        }

        function initializeExchangeRates() {
            // Create exchange rates based on USD
            const usdRates = {};
            currencies.forEach(currency => {
                usdRates[currency.code] = currency.rate;
            });
            
            // Calculate all cross rates
            exchangeRates = {};
            currencies.forEach(fromCurrency => {
                exchangeRates[fromCurrency.code] = {};
                currencies.forEach(toCurrency => {
                    if (fromCurrency.code === toCurrency.code) {
                        exchangeRates[fromCurrency.code][toCurrency.code] = 1;
                    } else {
                        // Convert from USD to target via USD
                        exchangeRates[fromCurrency.code][toCurrency.code] = 
                            (1 / usdRates[fromCurrency.code]) * usdRates[toCurrency.code];
                    }
                });
            });
            
            // Add some random fluctuation for realism
            Object.keys(exchangeRates).forEach(from => {
                Object.keys(exchangeRates[from]).forEach(to => {
                    if (from !== to) {
                        // Add ¬±0.5% random fluctuation
                        const fluctuation = 1 + (Math.random() - 0.5) * 0.01;
                        exchangeRates[from][to] *= fluctuation;
                    }
                });
            });
        }

        function fetchExchangeRates() {
            document.getElementById('chartLoader').style.display = 'block';
            
            // Simulate API call with realistic fluctuations
            setTimeout(() => {
                // Update rates with new fluctuations
                Object.keys(exchangeRates).forEach(from => {
                    Object.keys(exchangeRates[from]).forEach(to => {
                        if (from !== to) {
                            // Daily fluctuation ¬±2%
                            const dailyFluctuation = 1 + (Math.random() - 0.5) * 0.04;
                            exchangeRates[from][to] *= dailyFluctuation;
                        }
                    });
                });
                
                updateLastUpdateTime();
                convertCurrency();
                updatePopularCurrencies();
                
                // Update chart with new data
                updateChartData();
                
                document.getElementById('chartLoader').style.display = 'none';
                
                // Show success message
                showNotification('Kurslar muvaffaqiyatli yangilandi!');
            }, 1000);
        }

        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('uz-UZ', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('lastUpdate').textContent = timeString;
        }

        function convertCurrency() {
            const amount = parseFloat(document.getElementById('amount').value) || 0;
            const fromCurrency = document.getElementById('fromCurrency').value;
            const toCurrency = document.getElementById('toCurrency').value;
            
            currentFromCurrency = fromCurrency;
            currentToCurrency = toCurrency;
            
            if (amount <= 0) {
                document.getElementById('result').textContent = '0.00';
                document.getElementById('resultText').textContent = '0.00 = 0.00';
                return;
            }
            
            const rate = getExchangeRate(fromCurrency, toCurrency);
            const convertedAmount = amount * rate;
            
            // Format numbers
            const formatter = new Intl.NumberFormat('uz-UZ', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            
            const fromCurrencyObj = currencies.find(c => c.code === fromCurrency);
            const toCurrencyObj = currencies.find(c => c.code === toCurrency);
            
            document.getElementById('result').textContent = formatter.format(convertedAmount);
            document.getElementById('resultText').textContent = 
                `${formatter.format(amount)} ${fromCurrency} = ${formatter.format(convertedAmount)} ${toCurrency}`;
        }

        function getExchangeRate(from, to) {
            if (from === to) return 1;
            return exchangeRates[from]?.[to] || 1;
        }

        function swapCurrencies() {
            const fromSelect = document.getElementById('fromCurrency');
            const toSelect = document.getElementById('toCurrency');
            const amountInput = document.getElementById('amount');
            
            // Swap values
            const temp = fromSelect.value;
            fromSelect.value = toSelect.value;
            toSelect.value = temp;
            
            // Recalculate amount (inverse)
            const amount = parseFloat(amountInput.value) || 0;
            const rate = getExchangeRate(fromSelect.value, toSelect.value);
            if (amount > 0 && rate > 0) {
                amountInput.value = (amount / rate).toFixed(2);
            }
            
            convertCurrency();
            
            // Animation
            const swapBtn = document.getElementById('swapBtn');
            swapBtn.style.transform = 'rotate(360deg)';
            setTimeout(() => {
                swapBtn.style.transform = 'rotate(0deg)';
            }, 300);
        }

        function filterCurrencies(type) {
            const searchId = type === 'from' ? 'fromSearch' : 'toSearch';
            const selectId = type === 'from' ? 'fromCurrency' : 'toCurrency';
            
            const searchTerm = document.getElementById(searchId).value.toLowerCase();
            const select = document.getElementById(selectId);
            const options = select.getElementsByTagName('option');
            
            for (let option of options) {
                const text = option.text.toLowerCase();
                if (text.includes(searchTerm)) {
                    option.style.display = '';
                } else {
                    option.style.display = 'none';
                }
            }
        }

        // ============ POPULAR CURRENCIES ============
        function loadPopularCurrencies() {
            const popularCurrencies = ['USD', 'EUR', 'GBP', 'JPY', 'RUB', 'CNY', 'KZT', 'TRY', 'AED'];
            const container = document.getElementById('popularCurrencies');
            container.innerHTML = '';
            
            popularCurrencies.forEach(code => {
                const currency = currencies.find(c => c.code === code);
                if (!currency) return;
                
                const usdRate = getExchangeRate('USD', code);
                const change = (Math.random() - 0.5) * 2; // Random change ¬±2%
                
                const card = document.createElement('div');
                card.className = 'currency-card';
                card.onclick = () => selectPopularCurrency(code);
                
                card.innerHTML = `
                    <div class="currency-info">
                        <div class="currency-symbol">${currency.flag}</div>
                        <div class="currency-name">
                            <h4>${currency.code}</h4>
                            <p>${currency.name}</p>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div class="currency-rate">${usdRate.toFixed(4)}</div>
                        <div class="rate-change ${change >= 0 ? 'positive' : 'negative'}">
                            ${change >= 0 ? '+' : ''}${change.toFixed(2)}%
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function updatePopularCurrencies() {
            const cards = document.querySelectorAll('.currency-card');
            cards.forEach(card => {
                const code = card.querySelector('h4').textContent;
                const usdRate = getExchangeRate('USD', code);
                const change = (Math.random() - 0.5) * 2;
                
                const rateElement = card.querySelector('.currency-rate');
                const changeElement = card.querySelector('.rate-change');
                
                rateElement.textContent = usdRate.toFixed(4);
                changeElement.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
                changeElement.className = `rate-change ${change >= 0 ? 'positive' : 'negative'}`;
            });
        }

        function selectPopularCurrency(code) {
            document.getElementById('toCurrency').value = code;
            convertCurrency();
            
            // Highlight selected card
            document.querySelectorAll('.currency-card').forEach(card => {
                card.classList.remove('active');
                if (card.querySelector('h4').textContent === code) {
                    card.classList.add('active');
                }
            });
        }

        // ============ CHART FUNCTIONS ============
        function initializeChart() {
            const ctx = document.getElementById('exchangeChart').getContext('2d');
            const chartData = generateChartData('7d');
            
            chart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: getTextColor(),
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: getCardBgColor(),
                            titleColor: getTextColor(),
                            bodyColor: getTextColor(),
                            borderColor: getBorderColor(),
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: getBorderColor()
                            },
                            ticks: {
                                color: getTextMutedColor()
                            }
                        },
                        y: {
                            grid: {
                                color: getBorderColor()
                            },
                            ticks: {
                                color: getTextMutedColor()
                            }
                        }
                    }
                }
            });
        }

        function generateChartData(range) {
            let days = 7;
            switch(range) {
                case '30d': days = 30; break;
                case '90d': days = 90; break;
                case '1y': days = 365; break;
            }
            
            const labels = [];
            const data = [];
            const now = new Date();
            
            // Generate dates
            for (let i = days; i >= 0; i--) {
                const date = new Date(now);
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('uz-UZ', { month: 'short', day: 'numeric' }));
                
                // Generate realistic exchange rate data with trend
                const baseRate = getExchangeRate(currentFromCurrency, currentToCurrency);
                const trend = 0.0005; // Small upward trend
                const volatility = 0.02; // 2% daily volatility
                
                let rate = baseRate;
                if (i < days) {
                    const previousRate = data[data.length - 1];
                    const randomChange = (Math.random() - 0.5) * 2 * volatility;
                    rate = previousRate * (1 + trend + randomChange);
                }
                data.push(rate);
            }
            
            return {
                labels: labels,
                datasets: [{
                    label: `${currentFromCurrency}/${currentToCurrency} kursi`,
                    data: data,
                    borderColor: getPrimaryColor(),
                    backgroundColor: `${getPrimaryColor()}20`,
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: getPrimaryColor(),
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            };
        }

        function showChart(range) {
            // Update active tab
            document.querySelectorAll('.chart-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update chart data
            const chartData = generateChartData(range);
            chart.data = chartData;
            chart.update();
        }

        function updateChartData() {
            const chartData = generateChartData('7d');
            chart.data = chartData;
            chart.update();
        }

        function updateChartColors() {
            if (!chart) return;
            
            chart.options.plugins.legend.labels.color = getTextColor();
            chart.options.plugins.tooltip.backgroundColor = getCardBgColor();
            chart.options.plugins.tooltip.titleColor = getTextColor();
            chart.options.plugins.tooltip.bodyColor = getTextColor();
            chart.options.scales.x.grid.color = getBorderColor();
            chart.options.scales.x.ticks.color = getTextMutedColor();
            chart.options.scales.y.grid.color = getBorderColor();
            chart.options.scales.y.ticks.color = getTextMutedColor();
            
            chart.data.datasets[0].borderColor = getPrimaryColor();
            chart.data.datasets[0].backgroundColor = `${getPrimaryColor()}20`;
            
            chart.update();
        }

        // ============ HELPER FUNCTIONS ============
        function getPrimaryColor() {
            return currentTheme === 'dark' ? '#3b82f6' : '#2563eb';
        }

        function getCardBgColor() {
            return currentTheme === 'dark' ? '#1e293b' : '#ffffff';
        }

        function getTextColor() {
            return currentTheme === 'dark' ? '#f1f5f9' : '#1e293b';
        }

        function getTextMutedColor() {
            return currentTheme === 'dark' ? '#94a3b8' : '#64748b';
        }

        function getBorderColor() {
            return currentTheme === 'dark' ? '#334155' : '#e2e8f0';
        }

        function showNotification(message) {
            // Create notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, var(--primary), var(--secondary));
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: var(--shadow);
                z-index: 2000;
                animation: slideIn 0.3s ease;
            `;
            
            notification.innerHTML = `
                <i class="fas fa-check-circle" style="margin-right: 10px;"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
            
            // Add CSS for animations
            if (!document.querySelector('#notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // ============ AUTO UPDATE ============
        function startAutoUpdate() {
            // Update rates every 5 minutes
            setInterval(fetchExchangeRates, 5 * 60 * 1000);
            
            // Update popular currencies every minute
            setInterval(updatePopularCurrencies, 60 * 1000);
            
            // Simulate market fluctuations every 30 seconds
            setInterval(simulateMarketFluctuations, 30 * 1000);
        }

        function simulateMarketFluctuations() {
            // Small random fluctuations
            Object.keys(exchangeRates).forEach(from => {
                Object.keys(exchangeRates[from]).forEach(to => {
                    if (from !== to) {
                        const fluctuation = 1 + (Math.random() - 0.5) * 0.001; // ¬±0.1%
                        exchangeRates[from][to] *= fluctuation;
                    }
                });
            });
            
            // Update display if current conversion is affected
            const fromCurrency = document.getElementById('fromCurrency').value;
            const toCurrency = document.getElementById('toCurrency').value;
            if (fromCurrency === currentFromCurrency && toCurrency === currentToCurrency) {
                convertCurrency();
            }
        }

        // ============ INITIALIZATION ============
        window.addEventListener('DOMContentLoaded', () => {
            applyTheme();
            startClock();
            initializeCurrenciaes();
            initializeChart();
            startAutoUpdate();
            
            // Add event listeners
            document.getElementById('amount').addEventListener('input', convertCurrency);
            document.getElementById('amount').addEventListener('keyup', function(e) {
                if (e.key === 'Enter') convertCurrency();
            });
            
            // Initialize with realistic data
            fetchExchangeRates();
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            if (chart) {
                chart.resize();
            }
        });
    </script>
</body>
</html>
